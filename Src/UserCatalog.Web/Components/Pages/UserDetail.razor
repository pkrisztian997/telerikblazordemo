@page "/userdetail/{UserId:guid}"
@using System.Security
@using System.Xml.Serialization
@using System.Text
@using SHD.UserCatalog.BL
@using UserCatalog.Web.Components.Pages.ViewModels
@using UserCatalog.Web.Components.Pages.ViewModels.Converters
@using static UserCatalog.Web.Components.Pages.UserData
@inject HttpClient Http
@inject NavigationManager Nav
@inject IJSRuntime JS
@inject UserProxyConverter UserProxyConverter

<PageTitle>User Detail</PageTitle>

@if (_user == null)
{
    <p>Loading...</p>
}
else
{
    <EditForm Model="_user" OnValidSubmit="@OnValidSubmitHandler">
        <DataAnnotationsValidator />
        <ValidationSummary />

        <div class="mb-2">
            <label>Username</label>
            <TelerikTextBox @bind-Value="_user.Username" />
        </div>

        @* <div class="mb-2">
            <label>Password</label>
            <TelerikTextBox @bind-Value="_passwordPlain" Type="password" />
        </div> *@

        <div class="mb-2">
            <label>First Name</label>
            <TelerikTextBox @bind-Value="_user.FirstName" />
        </div>

        <div class="mb-2">
            <label>Last Name</label>
            <TelerikTextBox @bind-Value="_user.LastName" />
        </div>

        <div class="mb-2">
            <label>Date of Birth</label>
            <TelerikDatePicker @bind-Value="_user.DateOfBirth" Format="yyyy-MM-dd" />
        </div>

        <div class="mb-2">
            <label>Birth Place</label>
            <TelerikTextBox @bind-Value="_user.BirthPlace" />
        </div>

        <div class="mb-2">
            <label>Residence</label>
            <TelerikTextBox @bind-Value="_user.Residence" />
        </div>

        <div class="mt-3">
            <TelerikButton Class="btn btn-success">Mentés</TelerikButton>
            @* <TelerikButton OnClick="@GoBack" Class="btn btn-secondary">Vissza</TelerikButton> *@
        </div>
    </EditForm>
}

@code {
    [Parameter]
    public Guid UserId { get; set; }
    private UserProxy _user = new UserProxy();

    public void OnValidSubmitHandler(EditContext editContext)
    {
        //some logic when the form is valid.
        Console.WriteLine("valid submission, you can save the model");
    }

    override protected async Task OnInitializedAsync()
    {
        var response = await Http.GetAsync($"/api/user/{UserId}");
        if (!response.IsSuccessStatusCode)
        {
            return;
        }

        var json = await response.Content.ReadAsStringAsync();
        _user = (UserProxy)UserProxyConverter.ConvertUserToUserProxy(json);
    }
}
